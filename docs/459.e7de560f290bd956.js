"use strict";(self.webpackChunkPillApp=self.webpackChunkPillApp||[]).push([[459],{4459:(C,c,n)=>{n.r(c),n.d(c,{DrugTakeModule:()=>k});var u=n(9808),g=n(1135),i=n(2382),e=n(1223),d=n(5425),l=n(3438),m=n(2340),p=n(520);let h=(()=>{class t{constructor(r){this.http=r}getUserData(){return this.http.get(`${m.N.API_URL}/`)}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(p.eN))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var v=n(9192);function f(t,a){if(1&t&&(e.TgZ(0,"option",19),e._uU(1),e.qZA()),2&t){const r=a.$implicit;e.Q6J("value",r.id),e.xp6(1),e.Oqu(r.description)}}function D(t,a){1&t&&(e.TgZ(0,"div"),e._uU(1," El medicamento es obligatorio "),e.qZA())}function T(t,a){if(1&t&&(e.TgZ(0,"div",20),e.YNc(1,D,2,0,"div",21),e.qZA()),2&t){const r=e.oxw();e.xp6(1),e.Q6J("ngIf",r.drug.getError("required"))}}function A(t,a){1&t&&(e.TgZ(0,"div"),e._uU(1," El campo nombre es obligatorio "),e.qZA())}function Z(t,a){if(1&t&&(e.TgZ(0,"div",20),e.YNc(1,A,2,0,"div",21),e.qZA()),2&t){const r=e.oxw();e.xp6(1),e.Q6J("ngIf",r.dose.getError("required"))}}let b=(()=>{class t{constructor(r,o,s,y){this.activatedRoute=r,this.router=o,this.dataCreationService=s,this.drugListService=y,this.patientId=0,this.itemsDrug=new g.X([]),this.valuesDrug=[],this.submitted=!1,this.registerDrugActionForm=new i.cw({drug:new i.NI("",i.kI.required),dose:new i.NI("",i.kI.required),date:new i.NI(this.currentDate(),i.kI.required),time:new i.NI(this.currentTime(),i.kI.required)})}get drug(){return this.registerDrugActionForm.controls.drug}get dose(){return this.registerDrugActionForm.controls.dose}get date(){return this.registerDrugActionForm.controls.date}get time(){return this.registerDrugActionForm.controls.time}ngOnInit(){this.paramSub=this.activatedRoute.paramMap.subscribe(r=>{let o=r.get("id");null!=o&&(this.patientId=Number.parseInt(o),this.loadDrugList())})}ngOnDestroy(){this.paramSub.unsubscribe()}registerSubmit(){const r=this.registerDrugActionForm.value;if(this.registerDrugActionForm.valid){const o={drugId:r.drug,dose:r.dose,doneTimestamp:this.createTimestamp(r.date,r.time)};this.dataCreationService.registerDrugAction(o).subscribe(s=>{this.onReset()})}}loadDrugList(){this.drugListService.getUserData().subscribe(r=>{for(const o of r.updates)"drug"==o.type&&o.data.patientId==this.patientId&&(this.valuesDrug.push(o.data),this.itemsDrug.next(this.valuesDrug))})}onDrugSelected(){let r=this.registerDrugActionForm.controls.drug.value;for(let o of this.valuesDrug)o.id==r&&(this.registerDrugActionForm.controls.drug.setValue(o.id),this.registerDrugActionForm.controls.dose.setValue(o.dosePerIntake))}createTimestamp(r,o){return new Date(r+"T"+o).getTime()/1e3}currentDate(){return(new Date).toISOString().split("T")[0]}currentTime(){return(new Date).toLocaleString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1})}onReset(){this.submitted=!1,this.registerDrugActionForm.reset(),this.goBack()}goBack(){this.router.navigate(["/patient/"+this.patientId])}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(d.gz),e.Y36(d.F0),e.Y36(l.D),e.Y36(h))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-drug-take"]],decls:36,vars:7,consts:[[3,"backUrl"],[1,"vh-100"],[1,"card","col-12","col-sm-8","col-md-4","col-lg-3","col-xl-3","mx-auto","mt-5"],[1,"card-body","mx-5"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-5","mt-5"],[1,"h4"],[1,"form-control","form-select"],["formControlName","drug","id","drug","aria-describedby","drug",1,"form-control","form-select",3,"change"],["value","","selected","","disabled","","hidden",""],[3,"value",4,"ngFor","ngForOf"],["class","alert alert-danger mt-2",4,"ngIf"],[1,"form-group","mb-5"],["type","date","formControlName","date","id","date","placeholder","Introduce la fecha",1,"form-control","mb-3"],["type","time","formControlName","time","id","time","placeholder","Introduce la hora",1,"form-control"],["type","text","formControlName","dose","id","dose","aria-describedby","dose","placeholder","\xbfQu\xe9 dosis se ha suministrado?",1,"form-control"],[1,"text-center","mb-5"],["type","submit",1,"btn","btn-primary","mb-3"],[1,"btn","btn-outline-primary-cancel","mb-3",3,"click"],[3,"value"],[1,"alert","alert-danger","mt-2"],[4,"ngIf"]],template:function(r,o){1&r&&(e._UZ(0,"app-top-navigation",0),e.TgZ(1,"section",1)(2,"div",2)(3,"div",3)(4,"div")(5,"form",4),e.NdJ("ngSubmit",function(){return o.registerSubmit()}),e.TgZ(6,"div",5)(7,"p",6),e._uU(8,"Tipo de toma"),e.qZA(),e.TgZ(9,"select",7)(10,"option"),e._uU(11,"Medicamento prescrito"),e.qZA()()(),e.TgZ(12,"div",5)(13,"p",6),e._uU(14,"Selecciona medicamento"),e.qZA(),e.TgZ(15,"select",8),e.NdJ("change",function(){return o.onDrugSelected()}),e.TgZ(16,"option",9),e._uU(17,"Selecciona medicamento"),e.qZA(),e.YNc(18,f,2,2,"option",10),e.ALo(19,"async"),e.qZA(),e.YNc(20,T,2,1,"div",11),e.qZA(),e.TgZ(21,"div",12)(22,"p",6),e._uU(23,"Fecha y hora"),e.qZA(),e._UZ(24,"input",13)(25,"input",14),e.qZA(),e.TgZ(26,"div",5)(27,"p",6),e._uU(28,"Cantidad de la dosis"),e.qZA(),e._UZ(29,"input",15),e.YNc(30,Z,2,1,"div",11),e.qZA(),e.TgZ(31,"div",16)(32,"button",17),e._uU(33," crear "),e.qZA(),e.TgZ(34,"button",18),e.NdJ("click",function(){return o.goBack()}),e._uU(35," Cancelar "),e.qZA()()()()()()()),2&r&&(e.Q6J("backUrl","/patient/"+o.patientId),e.xp6(5),e.Q6J("formGroup",o.registerDrugActionForm),e.xp6(13),e.Q6J("ngForOf",e.lcZ(19,5,o.itemsDrug)),e.xp6(2),e.Q6J("ngIf",o.drug.invalid&&(o.drug.dirty||o.drug.touched)),e.xp6(10),e.Q6J("ngIf",o.dose.invalid&&(o.dose.dirty||o.dose.touched)))},directives:[v.g,i._Y,i.JL,i.sg,i.YN,i.Kr,i.EJ,i.JJ,i.u,u.sg,u.O5,i.Fj],pipes:[u.Ov],styles:[""]}),t})();var I=n(3408);const S=[{path:"",component:b}];let k=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[u.ez,d.Bz.forChild(S),i.UX,I.A]]}),t})()}}]);